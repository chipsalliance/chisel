"use strict";(globalThis.webpackChunkchisel_lang=globalThis.webpackChunkchisel_lang||[]).push([[7461],{5307(e,t,s){s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"developers/lit-test","title":"Lit Test","description":"We used llvm-lit and scala-cli to test CIRCT Converter. For how this tool works, see lit - LLVM Integrated Tester.","source":"@site/docs/developers/lit-test.md","sourceDirName":"developers","slug":"/developers/lit-test","permalink":"/docs/developers/lit-test","draft":false,"unlisted":false,"editUrl":"https://github.com/chipsalliance/chisel/tree/main/docs/src/developers/lit-test.md","tags":[],"version":"current","frontMatter":{"layout":"docs","title":"Lit Test","section":"chisel3"},"sidebar":"chiselSidebar","previous":{"title":"Developer Documentation","permalink":"/docs/developers"},"next":{"title":"Scaladoc","permalink":"/docs/developers/scaladoc"}}');var i=s(4848),l=s(8453);const r={layout:"docs",title:"Lit Test",section:"chisel3"},o="Lit Test",a={},c=[{value:"Run tests",id:"run-tests",level:2},{value:"Update test case",id:"update-test-case",level:2},{value:"Debugging",id:"debugging",level:4}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"lit-test",children:"Lit Test"})}),"\n",(0,i.jsxs)(t.p,{children:["We used llvm-lit and scala-cli to test CIRCT Converter. For how this tool works, see ",(0,i.jsx)(t.a,{href:"https://llvm.org/docs/CommandGuide/lit.html",children:"lit - LLVM Integrated Tester"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Ensure that the ",(0,i.jsx)(t.code,{children:"lit"}),", ",(0,i.jsx)(t.code,{children:"llvm"}),", and ",(0,i.jsx)(t.code,{children:"scala-cli"})," tools are available in your environment."]}),"\n",(0,i.jsx)(t.h2,{id:"run-tests",children:"Run tests"}),"\n",(0,i.jsxs)(t.p,{children:["The first line of the test file indicates how the test will be run, mostly in the form of ",(0,i.jsx)(t.code,{children:"scala-cli ... | FileCheck"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"To run all test cases, make sure the environment variables are defined first:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"JAVA_HOME"}),": The directory where the Java runtime environment. The Panama framework requires exact Java 21."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"mill -i lit[_].run\n"})}),"\n",(0,i.jsx)(t.h2,{id:"update-test-case",children:"Update test case"}),"\n",(0,i.jsxs)(t.p,{children:["There is a lack of a convenient way to debug test cases. But the ",(0,i.jsx)(t.code,{children:"println"})," debugging method always works."]}),"\n",(0,i.jsxs)(t.p,{children:["You need to temporarily modify ",(0,i.jsx)(t.code,{children:"panama.sc"})," to make ",(0,i.jsx)(t.code,{children:"lit"})," output more detailed (stdout, stderr)."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-diff",children:'diff --git a/panama.sc b/panama.sc\n--- a/panama.sc\n+++ b/panama.sc\n@@ -243,7 +243,7 @@ trait LitModule extends Module {\n     PathRef(T.dest)\n   }\n   def run(args: String*) = T.command(\n-    os.proc("lit", litConfig().path)\n+    os.proc("lit", litConfig().path, "-a")\n       .call(T.dest, stdout = os.ProcessOutput.Readlines(line => T.ctx().log.info("[lit] " + line)))\n   )\n }\n'})}),"\n",(0,i.jsxs)(t.p,{children:["If the output of ",(0,i.jsx)(t.code,{children:"FileCheck"})," confuses you, you will also need to temporarily remove the ",(0,i.jsx)(t.code,{children:"| FileCheck ..."})," from the test case file header."]}),"\n",(0,i.jsxs)(t.p,{children:["Then re-run ",(0,i.jsx)(t.code,{children:"mill -i lit[_].run"})," and you will see the output of the failed test cases. Check that they are correct and then update the test case."]}),"\n",(0,i.jsx)(t.h4,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsxs)(t.p,{children:["When interacting with CIRCT, it is easy to get a JVM crash, which is usually due to an unexpected error inside CIRCT (e.g. an assertion failure). Ensuring that CIRCT has been compiled with debug information (CMake option ",(0,i.jsx)(t.code,{children:"-DCMAKE_BUILD_TYPE=RelWithDebInfo"}),") and then checking the call stack of the crash will help you to localize the bug."]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,t,s){s.d(t,{R:()=>r,x:()=>o});var n=s(6540);const i={},l=n.createContext(i);function r(e){const t=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(l.Provider,{value:t},e.children)}}}]);