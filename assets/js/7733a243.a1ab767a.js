"use strict";(self.webpackChunkchisel_lang=self.webpackChunkchisel_lang||[]).push([[7461],{4089:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>a});var n=s(4848),i=s(8453);const l={layout:"docs",title:"Lit Test",section:"chisel3"},r="Lit Test",o={id:"developers/lit-test",title:"Lit Test",description:"We used llvm-lit and scala-cli to test CIRCT Converter. For how this tool works, see lit - LLVM Integrated Tester.",source:"@site/docs/developers/lit-test.md",sourceDirName:"developers",slug:"/developers/lit-test",permalink:"/docs/developers/lit-test",draft:!1,unlisted:!1,editUrl:"https://github.com/chipsalliance/chisel/tree/main/docs/src/developers/lit-test.md",tags:[],version:"current",frontMatter:{layout:"docs",title:"Lit Test",section:"chisel3"},sidebar:"chiselSidebar",previous:{title:"Developer Documentation",permalink:"/docs/developers"},next:{title:"Scaladoc",permalink:"/docs/developers/scaladoc"}},c={},a=[{value:"Run tests",id:"run-tests",level:2},{value:"Update test case",id:"update-test-case",level:2},{value:"Debugging",id:"debugging",level:4}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"lit-test",children:"Lit Test"})}),"\n",(0,n.jsxs)(t.p,{children:["We used llvm-lit and scala-cli to test CIRCT Converter. For how this tool works, see ",(0,n.jsx)(t.a,{href:"https://llvm.org/docs/CommandGuide/lit.html",children:"lit - LLVM Integrated Tester"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"run-tests",children:"Run tests"}),"\n",(0,n.jsxs)(t.p,{children:["The first line of the test file indicates how the test will be run, mostly in the form of ",(0,n.jsx)(t.code,{children:"scala-cli ... | FileCheck"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"To run all test cases, make sure the environment variables are defined first:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"JAVA_HOME"}),": The directory where the Java runtime environment. The Panama framework requires exact Java 21."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"mill -i lit[_].run\n"})}),"\n",(0,n.jsx)(t.h2,{id:"update-test-case",children:"Update test case"}),"\n",(0,n.jsxs)(t.p,{children:["There is a lack of a convenient way to debug test cases. But the ",(0,n.jsx)(t.code,{children:"println"})," debugging method always works."]}),"\n",(0,n.jsxs)(t.p,{children:["You need to temporarily modify ",(0,n.jsx)(t.code,{children:"tests.sc"})," to make ",(0,n.jsx)(t.code,{children:"lit"})," output more detailed (stdout, stderr)."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-diff",children:'-os.proc("lit", litConfig().path)\n+os.proc("lit", litConfig().path, "-a")\n'})}),"\n",(0,n.jsxs)(t.p,{children:["If the output of ",(0,n.jsx)(t.code,{children:"FileCheck"})," confuses you, you will also need to temporarily remove the ",(0,n.jsx)(t.code,{children:"| FileCheck ..."})," from the test case file header."]}),"\n",(0,n.jsxs)(t.p,{children:["Then re-run ",(0,n.jsx)(t.code,{children:"mill -i lit[_].run"})," and you will see the output of the failed test cases. Check that they are correct and then update the test case."]}),"\n",(0,n.jsx)(t.h4,{id:"debugging",children:"Debugging"}),"\n",(0,n.jsxs)(t.p,{children:["When interacting with CIRCT, it is easy to get a JVM crash, which is usually due to an unexpected error inside CIRCT (e.g. an assertion failure). Ensuring that CIRCT has been compiled with debug information (CMake option ",(0,n.jsx)(t.code,{children:"-DCMAKE_BUILD_TYPE=RelWithDebInfo"}),") and then checking the call stack of the crash will help you to localize the bug."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>o});var n=s(6540);const i={},l=n.createContext(i);function r(e){const t=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(l.Provider,{value:t},e.children)}}}]);