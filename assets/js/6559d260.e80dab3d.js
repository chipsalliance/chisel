"use strict";(self.webpackChunkchisel_lang=self.webpackChunkchisel_lang||[]).push([[8118],{2056:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var i=n(4848),s=n(8453);const a={layout:"docs",title:"Sequential Circuits",section:"chisel3"},r="Sequential Circuits",c={id:"explanations/sequential-circuits",title:"Sequential Circuits",description:"The simplest form of state element supported by Chisel is a positive edge-triggered register, which can be instantiated as:",source:"@site/docs/explanations/sequential-circuits.md",sourceDirName:"explanations",slug:"/explanations/sequential-circuits",permalink:"/docs/explanations/sequential-circuits",draft:!1,unlisted:!1,editUrl:"https://github.com/chipsalliance/chisel/tree/main/docs/src/explanations/sequential-circuits.md",tags:[],version:"current",frontMatter:{layout:"docs",title:"Sequential Circuits",section:"chisel3"},sidebar:"chiselSidebar",previous:{title:"Reset",permalink:"/docs/explanations/reset"},next:{title:"Source Locators",permalink:"/docs/explanations/source-locators"}},o={},l=[];function u(e){const t={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"sequential-circuits",children:"Sequential Circuits"})}),"\n",(0,i.jsx)(t.p,{children:"The simplest form of state element supported by Chisel is a positive edge-triggered register, which can be instantiated as:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"val reg = RegNext(in)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["This circuit has an output that is a copy of the input signal ",(0,i.jsx)(t.code,{children:"in"})," delayed by one clock cycle. Note that we do not have to specify the type of Reg as it will be automatically inferred from its input when instantiated in this way. In the current version of Chisel, clock and reset are global signals that are implicitly included where needed."]}),"\n",(0,i.jsx)(t.p,{children:"Note that registers which do not specify an initial value will not change value upon toggling the reset signal."}),"\n",(0,i.jsx)(t.p,{children:"Using registers, we can quickly define a number of useful circuit constructs. For example, a rising-edge detector that takes a boolean signal in and outputs true when the current value is true and the previous value is false is given by:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"def risingedge(x: Bool) = x && !RegNext(x)\n"})}),"\n",(0,i.jsx)(t.p,{children:"Counters are an important sequential circuit. To construct an up-counter that counts up to a maximum value, max, then wraps around back to zero (i.e., modulo max+1), we write:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"def counter(max: UInt) = {\n  val x = RegInit(0.asUInt(max.getWidth.W))\n  x := Mux(x === max, 0.U, x + 1.U)\n  x\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"The counter register is created in the counter function with a reset value of 0 (with width large enough to hold max), to which the register will be initialized when the global reset for the circuit is asserted. The := assignment to x in counter wires an update combinational circuit which increments the counter value unless it hits the max at which point it wraps back to zero. Note that when x appears on the right-hand side of an assignment, its output is referenced, whereas when on the left-hand side, its input is referenced.\nCounters can be used to build a number of useful sequential circuits. For example, we can build a pulse generator by outputting true when a counter reaches zero:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"// Produce pulse every n cycles.\ndef pulse(n: UInt) = counter(n - 1.U) === 0.U\n"})}),"\n",(0,i.jsx)(t.p,{children:"A square-wave generator can then be toggled by the pulse train, toggling between true and false on each pulse:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"// Flip internal state when input true.\ndef toggle(p: Bool) = {\n  val x = RegInit(false.B)\n  x := Mux(p, !x, x)\n  x\n}\n// Square wave of a given period.\ndef squareWave(period: UInt) = toggle(pulse(period >> 1))\n"})})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>c});var i=n(6540);const s={},a=i.createContext(s);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);