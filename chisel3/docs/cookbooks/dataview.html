<!DOCTYPE html><html><head><title>Chisel/FIRRTL: DataView Cookbook</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/chisel3/img/poster.png" /><meta name="image" property="og:image" content="/chisel3/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: DataView Cookbook" /><meta name="title" property="og:title" content="Chisel/FIRRTL: DataView Cookbook" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/chisel3/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: DataView Cookbook" /><meta name="twitter:image" content="https://chipsalliance.github.io//chisel3/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/chisel3/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/chisel3/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/chisel3/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/chisel3/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/chisel3/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/chisel3/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/chisel3/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/chisel3/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/chisel3/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/chisel3/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/chisel3/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/chisel3/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/chisel3/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/chisel3/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/chisel3/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/chisel3/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/chisel3/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/chisel3/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/chisel3/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/chisel3/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/chisel3/highlight/styles/vs.css" /><link rel="stylesheet" href="/chisel3/css/pattern-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/chisel3/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/chisel3/docs/introduction.html" class="">Chisel3</a></li> <li><a href="/chisel3/chisel3/docs/resources/resources.html" class="">Resources</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/resources/faqs.html" class="">FAQ</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/cookbooks/cookbooks.html" class="">Cookbooks</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/cookbooks/cookbook.html" class="">General Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/naming.html" class="">Naming Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/troubleshooting.html" class="">Troubleshooting</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/dataview.html" class=" active ">DataView Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/hierarchy.html" class="">Hierarchy Cookbook</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/explanations/explanations.html" class="">Explanations</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/explanations/motivation.html" class="">Motivation</a></li> <li><a href="/chisel3/chisel3/docs/explanations/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/chisel3/docs/explanations/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/chisel3/docs/explanations/dataview.html" class="">Dataview</a></li> <li><a href="/chisel3/chisel3/docs/explanations/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/chisel3/chisel3/docs/explanations/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/chisel3/docs/explanations/operators.html" class="">Operators</a></li> <li><a href="/chisel3/chisel3/docs/explanations/width-inference.html" class="">Width Inference</a></li> <li><a href="/chisel3/chisel3/docs/explanations/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/chisel3/docs/explanations/ports.html" class="">Ports</a></li> <li><a href="/chisel3/chisel3/docs/explanations/modules.html" class="">Modules</a></li> <li><a href="/chisel3/chisel3/docs/explanations/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/chisel3/docs/explanations/memories.html" class="">Memories</a></li> <li><a href="/chisel3/chisel3/docs/explanations/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/chisel3/docs/explanations/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/chisel3/docs/explanations/chisel-enum.html" class="">Enumerations</a></li> <li><a href="/chisel3/chisel3/docs/explanations/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/chisel3/docs/explanations/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/chisel3/docs/explanations/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/chisel3/docs/explanations/reset.html" class="">Reset</a></li> <li><a href="/chisel3/chisel3/docs/explanations/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/chisel3/docs/explanations/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/chisel3/docs/explanations/naming.html" class="">Naming</a></li> <li><a href="/chisel3/chisel3/docs/explanations/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/chisel3/docs/explanations/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/chisel3/docs/explanations/connection-operators.html" class="">Deep Dive into Connection Operators</a></li> <li><a href="/chisel3/chisel3/docs/explanations/chisel-type-vs-scala-type.html" class="">Chisel Type vs Scala Type</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/appendix/appendix.html" class="">Appendix</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/appendix/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel2</a></li> <li><a href="/chisel3/chisel3/docs/appendix/experimental-features.html" class="">Experimental Features</a></li> <li><a href="/chisel3/chisel3/docs/appendix/versioning.html" class="">Versioning</a></li> <li><a href="/chisel3/chisel3/docs/appendix/upgrading-from-chisel-3-4.html" class="">Upgrading From Chisel 3.4 to 3.5</a></li> <li><a href="/chisel3/chisel3/docs/appendix/upgrading-from-scala-2-11.html" class="">Upgrading From Scala 2.11</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/developers/developers.html" class="">Developers</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/developers/style.html" class="">Style Guide</a></li> <li><a href="/chisel3/chisel3/docs/developers/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/chisel3/docs/developers/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/chisel3/api/" class="">API Documentation</a> <ul class="sub-section"> <li><a href="/chisel3/api/chisel3/latest/" class="">Latest</a></li> <li><a href="/chisel3/api/chisel3/3.5/" class="">3.5</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li></ul></div></div></div></div><div id="content" data-github-owner="chipsalliance" data-github-repo="chisel3"><div class="content-wrapper"><section><h1 id="dataview-cookbook">DataView Cookbook</h1>

<ul>
  <li><a href="#how-do-i-view-a-data-as-a-uint-or-vice-versa">How do I view a Data as a UInt or vice versa?</a></li>
  <li><a href="#how-do-i-create-a-dataview-for-a-bundle-has-a-type-parameter">How do I create a DataView for a Bundle has a type parameter?</a></li>
  <li><a href="#how-do-i-create-a-dataview-for-a-bundle-with-optional-fields">How do I create a DataView for a Bundle with optional fields?</a></li>
  <li><a href="#how-do-i-connect-a-subset-of-bundle-fields">How do I connect a subset of Bundle fields?</a>
    <ul>
      <li><a href="#how-do-i-view-a-bundle-as-a-parent-type-superclass">How do I view a Bundle as a parent type (superclass)?</a></li>
      <li><a href="#how-do-i-view-a-bundle-as-a-parent-type-when-the-parent-type-is-abstract-like-a-trait">How do I view a Bundle as a parent type when the parent type is abstract (like a trait)?</a></li>
      <li><a href="#how-can-i-use-viewas-instead-of-viewassupertypetype">How can I use <code class="language-plaintext highlighter-rouge">.viewAs</code> instead of <code class="language-plaintext highlighter-rouge">.viewAsSupertype(type)</code>?</a></li>
    </ul>
  </li>
</ul>

<h2 id="how-do-i-view-a-data-as-a-uint-or-vice-versa">How do I view a Data as a UInt or vice versa?</h2>

<p>Subword viewing (using concatenations or bit extractions in <code class="language-plaintext highlighter-rouge">DataViews</code>) is not yet supported.
We intend to implement this in the future, but for the time being, use regular casts
(<code class="language-plaintext highlighter-rouge">.asUInt</code> and <code class="language-plaintext highlighter-rouge">.asTypeOf</code>).</p>

<h2 id="how-do-i-create-a-dataview-for-a-bundle-has-a-type-parameter">How do I create a DataView for a Bundle has a type parameter?</h2>

<p>Instead of using a <code class="language-plaintext highlighter-rouge">val</code>, use a <code class="language-plaintext highlighter-rouge">def</code> which can have type parameters:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.dataview._</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="k">val</span> <span class="nv">foo</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="k">val</span> <span class="nv">bar</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span>

<span class="k">object</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">def</span> <span class="nf">view</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">]</span><span class="k">:</span> <span class="kt">DataView</span><span class="o">[</span><span class="kt">Foo</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>, <span class="kt">Bar</span><span class="o">[</span><span class="kt">T</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">DataView</span><span class="o">(</span><span class="n">f</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="nv">f</span><span class="o">.</span><span class="py">foo</span><span class="o">.</span><span class="py">cloneType</span><span class="o">),</span> <span class="nv">_</span><span class="o">.</span><span class="py">foo</span> <span class="o">-&gt;</span> <span class="nv">_</span><span class="o">.</span><span class="py">bar</span><span class="o">)</span>
    <span class="c1">// .cloneType is necessary because the f passed to this function will be bound hardware</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you think about type parameterized classes as really being a family of different classes
(one for each type parameter), you can think about the <code class="language-plaintext highlighter-rouge">implicit def</code> as a generator of <code class="language-plaintext highlighter-rouge">DataViews</code>
for each type parameter.</p>

<h2 id="how-do-i-create-a-dataview-for-a-bundle-with-optional-fields">How do I create a DataView for a Bundle with optional fields?</h2>

<p>Instead of using the default <code class="language-plaintext highlighter-rouge">DataView</code> apply method, use <code class="language-plaintext highlighter-rouge">DataView.mapping</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.dataview._</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="o">(</span><span class="k">val</span> <span class="nv">w</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">opt</span> <span class="k">=</span> <span class="nv">w</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="o">(</span><span class="k">val</span> <span class="nv">w</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">opt</span> <span class="k">=</span> <span class="nv">w</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">view</span><span class="k">:</span> <span class="kt">DataView</span><span class="o">[</span><span class="kt">Foo</span>, <span class="kt">Bar</span><span class="o">]</span> <span class="k">=</span>
    <span class="nv">DataView</span><span class="o">.</span><span class="py">mapping</span><span class="o">(</span>
      <span class="c1">// First argument is always the function to make the view from the target</span>
      <span class="n">f</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="nv">f</span><span class="o">.</span><span class="py">w</span><span class="o">),</span>
      <span class="c1">// Now instead of a varargs of tuples of individual mappings, we have a single function that</span>
      <span class="c1">// takes a target and a view and returns an Iterable of tuple</span>
      <span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span>  <span class="nc">List</span><span class="o">(</span><span class="nv">f</span><span class="o">.</span><span class="py">foo</span> <span class="o">-&gt;</span> <span class="nv">b</span><span class="o">.</span><span class="py">bar</span><span class="o">)</span> <span class="o">++</span> <span class="nv">f</span><span class="o">.</span><span class="py">opt</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="k">_</span> <span class="o">-&gt;</span> <span class="nv">b</span><span class="o">.</span><span class="py">opt</span><span class="o">.</span><span class="py">get</span><span class="o">)</span>
                                   <span class="c1">// ^ Note that we can append options since they are Iterable!</span>

    <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="how-do-i-connect-a-subset-of-bundle-fields">How do I connect a subset of Bundle fields?</h2>

<p>Chisel 3 requires types to match exactly for connections.
DataView provides a mechanism for “viewing” one <code class="language-plaintext highlighter-rouge">Bundle</code> object as if it were the type of another,
which allows them to be connected.</p>

<h3 id="how-do-i-view-a-bundle-as-a-parent-type-superclass">How do I view a Bundle as a parent type (superclass)?</h3>

<p>For viewing <code class="language-plaintext highlighter-rouge">Bundles</code> as the type of the parent, it is as simple as using <code class="language-plaintext highlighter-rouge">viewAsSupertype</code> and providing a
template object of the parent type:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.dataview._</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="k">extends</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">MyModule</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="k">new</span> <span class="nc">Foo</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bar</span><span class="o">))</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">viewAsSupertype</span><span class="o">(</span><span class="k">new</span> <span class="nc">Foo</span><span class="o">)</span> <span class="o">:=</span> <span class="n">foo</span> <span class="c1">// bar.foo := foo.foo</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">bar</span> <span class="o">:=</span> <span class="mf">123.</span><span class="n">U</span>           <span class="c1">// all fields need to be connected</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Generated by CIRCT firtool-1.30.0</span>
<span class="k">module</span> <span class="n">MyModule</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="kt">input</span>        <span class="n">clock</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:4:11</span>
               <span class="n">reset</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:5:11</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">foo_foo</span><span class="p">,</span>	<span class="c1">// dataview.md:118:15</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">bar_foo</span><span class="p">,</span>	<span class="c1">// dataview.md:119:15</span>
               <span class="n">bar_bar</span>	<span class="c1">// dataview.md:119:15</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">bar_foo</span> <span class="o">=</span> <span class="n">foo_foo</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="k">assign</span> <span class="n">bar_bar</span> <span class="o">=</span> <span class="mh">8'h7B</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10, dataview.md:121:11</span>
<span class="k">endmodule</span>

</code></pre></div></div>

<h3 id="how-do-i-view-a-bundle-as-a-parent-type-when-the-parent-type-is-abstract-like-a-trait">How do I view a Bundle as a parent type when the parent type is abstract (like a trait)?</h3>

<p>Given the following <code class="language-plaintext highlighter-rouge">Bundles</code> that share a common <code class="language-plaintext highlighter-rouge">trait</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.dataview._</span>

<span class="k">trait</span> <span class="nc">Super</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">bitwidth</span><span class="k">:</span> <span class="kt">Int</span>
  <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">bitwidth</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="o">(</span><span class="k">val</span> <span class="nv">bitwidth</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Super</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="o">(</span><span class="k">val</span> <span class="nv">bitwidth</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Super</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Foo</code> and <code class="language-plaintext highlighter-rouge">Bar</code> cannot be connected directly, but they could be connected by viewing them both as if
they were instances of their common supertype, <code class="language-plaintext highlighter-rouge">Super</code>.
A straightforward approach might run into an issue like the following:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyModule</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="k">new</span> <span class="nc">Foo</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">viewAsSupertype</span><span class="o">(</span><span class="k">new</span> <span class="nc">Super</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">foo</span><span class="o">.</span><span class="py">viewAsSupertype</span><span class="o">(</span><span class="k">new</span> <span class="nc">Super</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// error: trait Super is abstract; cannot be instantiated</span>
<span class="c1">//   bar.viewAsSupertype(new Super) := foo.viewAsSupertype(new Super)</span>
<span class="c1">//                       ^^^^^^^^^</span>
<span class="c1">// error: trait Super is abstract; cannot be instantiated</span>
<span class="c1">//   bar.viewAsSupertype(new Super) := foo.viewAsSupertype(new Super)</span>
<span class="c1">//                                                         ^^^^^^^^^</span>
</code></pre></div></div>

<p>The problem is that <code class="language-plaintext highlighter-rouge">viewAs</code> requires an object to use as a type template (so that it can be cloned),
but <code class="language-plaintext highlighter-rouge">traits</code> are abstract and cannot be instantiated.
The solution is to create an instance of an <em>anonymous class</em> and use that object as the argument to <code class="language-plaintext highlighter-rouge">viewAs</code>.
We can do this like so:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyModule</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="k">new</span> <span class="nc">Foo</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="k">val</span> <span class="nv">tpe</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Super</span> <span class="o">{</span> <span class="c1">// Adding curly braces creates an anonymous class</span>
    <span class="k">def</span> <span class="nf">bitwidth</span> <span class="k">=</span> <span class="mi">8</span> <span class="c1">// We must implement any abstract methods</span>
  <span class="o">}</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">viewAsSupertype</span><span class="o">(</span><span class="n">tpe</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">foo</span><span class="o">.</span><span class="py">viewAsSupertype</span><span class="o">(</span><span class="n">tpe</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
<p>By adding curly braces after the name of the trait, we’re telling Scala to create a new concrete
subclass of the trait, and create an instance of it.
As indicated in the comment, abstract methods must still be implemented.
This is the same that happens when one writes <code class="language-plaintext highlighter-rouge">new Bundle {}</code>,
the curly braces create a new concrete subclass; however, because <code class="language-plaintext highlighter-rouge">Bundle</code> has no abstract methods,
the contents of the body can be empty.</p>

<h3 id="how-can-i-use-viewas-instead-of-viewassupertypetype">How can I use <code class="language-plaintext highlighter-rouge">.viewAs</code> instead of <code class="language-plaintext highlighter-rouge">.viewAsSupertype(type)</code>?</h3>

<p>While <code class="language-plaintext highlighter-rouge">viewAsSupertype</code> is helpful for one-off casts, the need to provide a type template object
each time can be onerous.
Because of the subtyping relationship, you can use <code class="language-plaintext highlighter-rouge">PartialDataView.supertype</code> to create a
<code class="language-plaintext highlighter-rouge">DataView</code> from a Bundle type to a parent type by just providing the function to construct an
instance of the parent type from an instance of the child type.
The mapping of corresponding fields is automatically determined by Chisel to be the fields defined
in the supertype.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.dataview._</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="o">(</span><span class="k">val</span> <span class="nv">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Define a DataView without having to specify the mapping!</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">view</span> <span class="k">=</span> <span class="nv">PartialDataView</span><span class="o">.</span><span class="py">supertype</span><span class="o">[</span><span class="kt">Bar</span>, <span class="kt">Foo</span><span class="o">](</span><span class="n">b</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Foo</span><span class="o">(</span><span class="nv">b</span><span class="o">.</span><span class="py">x</span><span class="o">))</span>

<span class="k">class</span> <span class="nc">MyModule</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="k">new</span> <span class="nc">Foo</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="mi">8</span><span class="o">)))</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">viewAs</span><span class="o">[</span><span class="kt">Foo</span><span class="o">]</span> <span class="o">:=</span> <span class="n">foo</span> <span class="c1">// bar.foo := foo.foo</span>
  <span class="nv">bar</span><span class="o">.</span><span class="py">bar</span> <span class="o">:=</span> <span class="mf">123.</span><span class="n">U</span>       <span class="c1">// all fields need to be connected</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Generated by CIRCT firtool-1.30.0</span>
<span class="k">module</span> <span class="n">MyModule</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="kt">input</span>        <span class="n">clock</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:4:11</span>
               <span class="n">reset</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:5:11</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">foo_foo</span><span class="p">,</span>	<span class="c1">// dataview.md:204:15</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">bar_foo</span><span class="p">,</span>	<span class="c1">// dataview.md:205:15</span>
               <span class="n">bar_bar</span>	<span class="c1">// dataview.md:205:15</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">bar_foo</span> <span class="o">=</span> <span class="n">foo_foo</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="k">assign</span> <span class="n">bar_bar</span> <span class="o">=</span> <span class="mh">8'h7B</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10, dataview.md:207:11</span>
<span class="k">endmodule</span>

</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/chisel3/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/verilog.min.js"></script><script src="/chisel3/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','verilog']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'chipsalliance/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/chisel3/js/search.js"></script><script src="/chisel3/js/main.js"></script></body></html>