<!DOCTYPE html><html><head><title>Chisel/FIRRTL: Polymorphism and Parameterization</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/chisel3/img/poster.png" /><meta name="image" property="og:image" content="/chisel3/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Polymorphism and Parameterization" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Polymorphism and Parameterization" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/chisel3/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Polymorphism and Parameterization" /><meta name="twitter:image" content="https://chipsalliance.github.io//chisel3/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/chisel3/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/chisel3/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/chisel3/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/chisel3/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/chisel3/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/chisel3/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/chisel3/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/chisel3/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/chisel3/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/chisel3/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/chisel3/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/chisel3/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/chisel3/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/chisel3/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/chisel3/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/chisel3/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/chisel3/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/chisel3/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/chisel3/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/chisel3/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/chisel3/highlight/styles/vs.css" /><link rel="stylesheet" href="/chisel3/css/pattern-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/chisel3/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/chisel3/docs/introduction.html" class="">Chisel3</a></li> <li><a href="/chisel3/chisel3/docs/resources/resources.html" class="">Resources</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/resources/faqs.html" class="">FAQ</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/cookbooks/cookbooks.html" class="">Cookbooks</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/cookbooks/cookbook.html" class="">General Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/naming.html" class="">Naming Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/troubleshooting.html" class="">Troubleshooting</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/dataview.html" class="">DataView Cookbook</a></li> <li><a href="/chisel3/chisel3/docs/cookbooks/hierarchy.html" class="">Hierarchy Cookbook</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/explanations/explanations.html" class="">Explanations</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/explanations/motivation.html" class="">Motivation</a></li> <li><a href="/chisel3/chisel3/docs/explanations/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/chisel3/docs/explanations/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/chisel3/docs/explanations/dataview.html" class="">Dataview</a></li> <li><a href="/chisel3/chisel3/docs/explanations/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/chisel3/chisel3/docs/explanations/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/chisel3/docs/explanations/operators.html" class="">Operators</a></li> <li><a href="/chisel3/chisel3/docs/explanations/width-inference.html" class="">Width Inference</a></li> <li><a href="/chisel3/chisel3/docs/explanations/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/chisel3/docs/explanations/ports.html" class="">Ports</a></li> <li><a href="/chisel3/chisel3/docs/explanations/modules.html" class="">Modules</a></li> <li><a href="/chisel3/chisel3/docs/explanations/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/chisel3/docs/explanations/memories.html" class="">Memories</a></li> <li><a href="/chisel3/chisel3/docs/explanations/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/chisel3/docs/explanations/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/chisel3/docs/explanations/chisel-enum.html" class="">Enumerations</a></li> <li><a href="/chisel3/chisel3/docs/explanations/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/chisel3/docs/explanations/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/chisel3/docs/explanations/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/chisel3/docs/explanations/reset.html" class="">Reset</a></li> <li><a href="/chisel3/chisel3/docs/explanations/polymorphism-and-parameterization.html" class=" active ">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/chisel3/docs/explanations/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/chisel3/docs/explanations/naming.html" class="">Naming</a></li> <li><a href="/chisel3/chisel3/docs/explanations/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/chisel3/docs/explanations/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/chisel3/docs/explanations/connection-operators.html" class="">Deep Dive into Connection Operators</a></li> <li><a href="/chisel3/chisel3/docs/explanations/chisel-type-vs-scala-type.html" class="">Chisel Type vs Scala Type</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/appendix/appendix.html" class="">Appendix</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/appendix/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel2</a></li> <li><a href="/chisel3/chisel3/docs/appendix/experimental-features.html" class="">Experimental Features</a></li> <li><a href="/chisel3/chisel3/docs/appendix/versioning.html" class="">Versioning</a></li> <li><a href="/chisel3/chisel3/docs/appendix/upgrading-from-chisel-3-4.html" class="">Upgrading From Chisel 3.4 to 3.5</a></li> <li><a href="/chisel3/chisel3/docs/appendix/upgrading-from-scala-2-11.html" class="">Upgrading From Scala 2.11</a></li></ul></li> <li><a href="/chisel3/chisel3/docs/developers/developers.html" class="">Developers</a> <ul class="sub-section"> <li><a href="/chisel3/chisel3/docs/developers/style.html" class="">Style Guide</a></li> <li><a href="/chisel3/chisel3/docs/developers/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/chisel3/docs/developers/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/chisel3/api/" class="">API Documentation</a> <ul class="sub-section"> <li><a href="/chisel3/api/chisel3/latest/" class="">Latest</a></li> <li><a href="/chisel3/api/chisel3/3.5/" class="">3.5</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li></ul></div></div></div></div><div id="content" data-github-owner="chipsalliance" data-github-repo="chisel3"><div class="content-wrapper"><section><h1 id="polymorphism-and-parameterization">Polymorphism and Parameterization</h1>

<p><em>This section is advanced and can be skipped at first reading.</em></p>

<p>Scala is a strongly typed language and uses parameterized types to specify generic functions and classes.
In this section, we show how Chisel users can define their own reusable functions and classes using parameterized classes.</p>

<h2 id="parameterized-functions">Parameterized Functions</h2>

<p>Earlier we defined <code class="language-plaintext highlighter-rouge">Mux2</code> on <code class="language-plaintext highlighter-rouge">Bool</code>, but now we show how we can define a generic multiplexer function.
We define this function as taking a boolean condition and con and alt arguments (corresponding to then and else expressions) of type <code class="language-plaintext highlighter-rouge">T</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">Mux</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Bits</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">Bool</span><span class="o">,</span> <span class="n">con</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">alt</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">T</code> is required to be a subclass of <code class="language-plaintext highlighter-rouge">Bits</code>.
Scala ensures that in each usage of <code class="language-plaintext highlighter-rouge">Mux</code>, it can find a common superclass of the actual con and alt argument types,
otherwise it causes a Scala compilation type error.
For example,</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Mux</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="nc">UInt</span><span class="o">(</span><span class="mi">11</span><span class="o">))</span>
</code></pre></div></div>

<p>yields a <code class="language-plaintext highlighter-rouge">UInt</code> wire because the <code class="language-plaintext highlighter-rouge">con</code> and <code class="language-plaintext highlighter-rouge">alt</code> arguments are each of type <code class="language-plaintext highlighter-rouge">UInt</code>.</p>

<!---
Jack: I cannot seem to get this to actually work
      Scala does not like the * in FIR since it could be from UInt or SInt

We now present a more advanced example of parameterized functions for defining an inner product FIR digital filter generically over Chisel `Num`s.

The inner product FIR filter can be mathematically defined as:
\begin{equation}
y[t] = \sum_j w_j * x_j[t-j]
\end{equation}


where `x` is the input and `w` is a vector of weights.
In Chisel this can be defined as:


```scala
def delays[T <: Data](x: T, n: Int): List[T] =
  if (n <= 1) List(x) else x :: delays(RegNext(x), n - 1)

def FIR[T <: Data with Num[T]](ws: Seq[T], x: T): T =
  ws zip delays(x, ws.length) map { case (a, b) => a * b } reduce (_ + _)
```

where
`delays` creates a list of incrementally increasing delays of its input and
`reduce` constructs a reduction circuit given a binary combiner function `f`.
In this case, `reduce` creates a summation circuit.
Finally, the `FIR` function is constrained to work on inputs of type `Num` where Chisel multiplication and addition are defined.
--->

<h2 id="parameterized-classes">Parameterized Classes</h2>

<p>Like parameterized functions, we can also parameterize classes to make them more reusable.
For instance, we can generalize the Filter class to use any kind of link.
We do so by parameterizing the <code class="language-plaintext highlighter-rouge">FilterIO</code> class and defining the constructor to take a single argument <code class="language-plaintext highlighter-rouge">gen</code> of type <code class="language-plaintext highlighter-rouge">T</code> as below.</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FilterIO</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">gen</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">x</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="n">gen</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">y</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="n">gen</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can now define <code class="language-plaintext highlighter-rouge">Filter</code> by defining a module class that also takes a link type constructor argument and passes it through to the <code class="language-plaintext highlighter-rouge">FilterIO</code> interface constructor:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Filter</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">gen</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">FilterIO</span><span class="o">(</span><span class="n">gen</span><span class="o">))</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can now define a <code class="language-plaintext highlighter-rouge">PLink</code>-based <code class="language-plaintext highlighter-rouge">Filter</code> as follows:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">f</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">Filter</span><span class="o">(</span><span class="k">new</span> <span class="nc">PLink</span><span class="o">))</span>
</code></pre></div></div>

<p>A generic FIFO could be defined as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.util.log2Up</span>

<span class="k">class</span> <span class="nc">DataBundle</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Fifo</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">gen</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">enqVal</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="nv">enqRdy</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="nv">deqVal</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="nv">deqRdy</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="nv">enqDat</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="n">gen</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">deqDat</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="n">gen</span><span class="o">)</span>
  <span class="o">})</span>
  <span class="k">val</span> <span class="nv">enqPtr</span>     <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="nf">U</span><span class="o">((</span><span class="nf">log2Up</span><span class="o">(</span><span class="n">n</span><span class="o">)).</span><span class="py">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">deqPtr</span>     <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="nf">U</span><span class="o">((</span><span class="nf">log2Up</span><span class="o">(</span><span class="n">n</span><span class="o">)).</span><span class="py">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">isFull</span>     <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="nv">false</span><span class="o">.</span><span class="py">B</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">doEnq</span>      <span class="k">=</span> <span class="nv">io</span><span class="o">.</span><span class="py">enqRdy</span> <span class="o">&amp;&amp;</span> <span class="nv">io</span><span class="o">.</span><span class="py">enqVal</span>
  <span class="k">val</span> <span class="nv">doDeq</span>      <span class="k">=</span> <span class="nv">io</span><span class="o">.</span><span class="py">deqRdy</span> <span class="o">&amp;&amp;</span> <span class="nv">io</span><span class="o">.</span><span class="py">deqVal</span>
  <span class="k">val</span> <span class="nv">isEmpty</span>    <span class="k">=</span> <span class="o">!</span><span class="n">isFull</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">enqPtr</span> <span class="o">===</span> <span class="n">deqPtr</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">deqPtrInc</span>  <span class="k">=</span> <span class="n">deqPtr</span> <span class="o">+</span> <span class="mf">1.</span><span class="n">U</span>
  <span class="k">val</span> <span class="nv">enqPtrInc</span>  <span class="k">=</span> <span class="n">enqPtr</span> <span class="o">+</span> <span class="mf">1.</span><span class="n">U</span>
  <span class="k">val</span> <span class="nv">isFullNext</span> <span class="k">=</span> <span class="nc">Mux</span><span class="o">(</span><span class="n">doEnq</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">doDeq</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">enqPtrInc</span> <span class="o">===</span> <span class="n">deqPtr</span><span class="o">),</span>
                         <span class="nv">true</span><span class="o">.</span><span class="py">B</span><span class="o">,</span> <span class="nc">Mux</span><span class="o">(</span><span class="n">doDeq</span> <span class="o">&amp;&amp;</span> <span class="n">isFull</span><span class="o">,</span> <span class="nv">false</span><span class="o">.</span><span class="py">B</span><span class="o">,</span>
                         <span class="n">isFull</span><span class="o">))</span>
  <span class="n">enqPtr</span> <span class="o">:=</span> <span class="nc">Mux</span><span class="o">(</span><span class="n">doEnq</span><span class="o">,</span> <span class="n">enqPtrInc</span><span class="o">,</span> <span class="n">enqPtr</span><span class="o">)</span>
  <span class="n">deqPtr</span> <span class="o">:=</span> <span class="nc">Mux</span><span class="o">(</span><span class="n">doDeq</span><span class="o">,</span> <span class="n">deqPtrInc</span><span class="o">,</span> <span class="n">deqPtr</span><span class="o">)</span>
  <span class="n">isFull</span> <span class="o">:=</span> <span class="n">isFullNext</span>
  <span class="k">val</span> <span class="nv">ram</span> <span class="k">=</span> <span class="nc">Mem</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">gen</span><span class="o">)</span>
  <span class="nf">when</span> <span class="o">(</span><span class="n">doEnq</span><span class="o">)</span> <span class="o">{</span>
    <span class="nf">ram</span><span class="o">(</span><span class="n">enqPtr</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">enqDat</span>
  <span class="o">}</span>
  <span class="nv">io</span><span class="o">.</span><span class="py">enqRdy</span> <span class="o">:=</span> <span class="o">!</span><span class="n">isFull</span>
  <span class="nv">io</span><span class="o">.</span><span class="py">deqVal</span> <span class="o">:=</span> <span class="o">!</span><span class="n">isEmpty</span>
  <span class="nf">ram</span><span class="o">(</span><span class="n">deqPtr</span><span class="o">)</span> <span class="o">&lt;&gt;</span> <span class="nv">io</span><span class="o">.</span><span class="py">deqDat</span>
<span class="o">}</span>
</code></pre></div></div>

<p>An Fifo with 8 elements of type DataBundle could then be instantiated as:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">fifo</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">Fifo</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataBundle</span><span class="o">,</span> <span class="mi">8</span><span class="o">))</span>
</code></pre></div></div>

<p>It is also possible to define a generic decoupled (ready/valid) interface:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DecoupledIO</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">ready</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
  <span class="k">val</span> <span class="nv">valid</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
  <span class="k">val</span> <span class="nv">bits</span>  <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This template can then be used to add a handshaking protocol to any
set of signals:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DecoupledDemo</span> <span class="k">extends</span> <span class="nc">DecoupledIO</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataBundle</span><span class="o">)</span>
</code></pre></div></div>

<p>The FIFO interface can be now be simplified as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Fifo</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">enq</span> <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="k">new</span> <span class="nc">DecoupledIO</span><span class="o">(</span><span class="n">data</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">deq</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DecoupledIO</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
  <span class="o">})</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="parametrization-based-on-modules">Parametrization based on Modules</h2>

<p>You can also parametrize modules based on other modules rather than just types. The following is an example of a module parametrized by other modules as opposed to e.g. types.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.RawModule</span>
<span class="k">import</span> <span class="nn">chisel3.experimental.BaseModule</span>
<span class="k">import</span> <span class="nn">circt.stage.ChiselStage</span>

<span class="c1">// Provides a more specific interface since generic Module</span>
<span class="c1">// provides no compile-time information on generic module's IOs.</span>
<span class="k">trait</span> <span class="nc">MyAdder</span> <span class="o">{</span>
    <span class="k">def</span> <span class="nf">in1</span><span class="k">:</span> <span class="kt">UInt</span>
    <span class="k">def</span> <span class="nf">in2</span><span class="k">:</span> <span class="kt">UInt</span>
    <span class="k">def</span> <span class="nf">out</span><span class="k">:</span> <span class="kt">UInt</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Mod1</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="k">with</span> <span class="nc">MyAdder</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">in1</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="k">val</span> <span class="nv">in2</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="n">out</span> <span class="o">:=</span> <span class="n">in1</span> <span class="o">+</span> <span class="n">in2</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Mod2</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="k">with</span> <span class="nc">MyAdder</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">in1</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="k">val</span> <span class="nv">in2</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
    <span class="n">out</span> <span class="o">:=</span> <span class="n">in1</span> <span class="o">-</span> <span class="n">in2</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">X</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">BaseModule</span> <span class="kt">with</span> <span class="kt">MyAdder</span><span class="o">](</span><span class="n">genT</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">in1</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nv">in2</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">))</span>
    <span class="o">})</span>
    <span class="k">val</span> <span class="nv">subMod</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="n">genT</span><span class="o">)</span>
    <span class="nv">io</span><span class="o">.</span><span class="py">out</span> <span class="o">:=</span> <span class="nv">subMod</span><span class="o">.</span><span class="py">out</span>
    <span class="nv">subMod</span><span class="o">.</span><span class="py">in1</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">in1</span>
    <span class="nv">subMod</span><span class="o">.</span><span class="py">in2</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">in2</span>
<span class="o">}</span>

<span class="nf">println</span><span class="o">(</span><span class="nv">ChiselStage</span><span class="o">.</span><span class="py">emitSystemVerilog</span><span class="o">(</span><span class="k">new</span> <span class="nf">X</span><span class="o">(</span><span class="k">new</span> <span class="nc">Mod1</span><span class="o">)))</span>
<span class="nf">println</span><span class="o">(</span><span class="nv">ChiselStage</span><span class="o">.</span><span class="py">emitSystemVerilog</span><span class="o">(</span><span class="k">new</span> <span class="nf">X</span><span class="o">(</span><span class="k">new</span> <span class="nc">Mod2</span><span class="o">)))</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Generated by CIRCT firtool-1.30.0</span>
<span class="k">module</span> <span class="n">Mod1</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">in1</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:171:17</span>
               <span class="n">in2</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:172:17</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">out</span>	<span class="c1">// polymorphism-and-parameterization.md:173:17</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">+</span> <span class="n">in2</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10, polymorphism-and-parameterization.md:174:16</span>
<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">X</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:12:10</span>
  <span class="kt">input</span>        <span class="n">clock</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:13:11</span>
               <span class="n">reset</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:14:11</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">io_in1</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
               <span class="n">io_in2</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">io_out</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
<span class="p">);</span>

  <span class="n">Mod1</span> <span class="n">subMod</span> <span class="p">(</span>	<span class="c1">// polymorphism-and-parameterization.md:192:24</span>
    <span class="p">.</span><span class="n">in1</span> <span class="p">(</span><span class="n">io_in1</span><span class="p">),</span>
    <span class="p">.</span><span class="n">in2</span> <span class="p">(</span><span class="n">io_in2</span><span class="p">),</span>
    <span class="p">.</span><span class="n">out</span> <span class="p">(</span><span class="n">io_out</span><span class="p">)</span>
  <span class="p">);</span>
<span class="k">endmodule</span>

<span class="c1">// Generated by CIRCT firtool-1.30.0</span>
<span class="k">module</span> <span class="n">Mod2</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:3:10</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">in1</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:179:17</span>
               <span class="n">in2</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:180:17</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">out</span>	<span class="c1">// polymorphism-and-parameterization.md:181:17</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">in1</span> <span class="o">-</span> <span class="n">in2</span><span class="p">;</span>	<span class="c1">// &lt;stdin&gt;:3:10, polymorphism-and-parameterization.md:182:16</span>
<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">X</span><span class="p">(</span>	<span class="c1">// &lt;stdin&gt;:12:10</span>
  <span class="kt">input</span>        <span class="n">clock</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:13:11</span>
               <span class="n">reset</span><span class="p">,</span>	<span class="c1">// &lt;stdin&gt;:14:11</span>
  <span class="kt">input</span>  <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">io_in1</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
               <span class="n">io_in2</span><span class="p">,</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
  <span class="kt">output</span> <span class="p">[</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">io_out</span>	<span class="c1">// polymorphism-and-parameterization.md:187:16</span>
<span class="p">);</span>

  <span class="n">Mod2</span> <span class="n">subMod</span> <span class="p">(</span>	<span class="c1">// polymorphism-and-parameterization.md:192:24</span>
    <span class="p">.</span><span class="n">in1</span> <span class="p">(</span><span class="n">io_in1</span><span class="p">),</span>
    <span class="p">.</span><span class="n">in2</span> <span class="p">(</span><span class="n">io_in2</span><span class="p">),</span>
    <span class="p">.</span><span class="n">out</span> <span class="p">(</span><span class="n">io_out</span><span class="p">)</span>
  <span class="p">);</span>
<span class="k">endmodule</span>

</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/chisel3/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/verilog.min.js"></script><script src="/chisel3/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','verilog']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'chipsalliance/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/chisel3/js/search.js"></script><script src="/chisel3/js/main.js"></script></body></html>